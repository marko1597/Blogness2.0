"use strict";angular.module("com.2fdevs.videogular.plugins.imaads",[]).directive("vgImaAds",["$window","VG_STATES",function(a,b){return{restrict:"E",require:"^videogular",scope:{vgNetwork:"=",vgUnitPath:"=",vgCompanion:"=",vgCompanionSize:"=",vgAdTagUrl:"="},link:function(c,d,e,f){function g(a){switch(a){case b.PLAY:x||(f.pause(),u.initialize(),h(c.vgAdTagUrl),x=!0);break;case b.STOP:t=!0,v.contentComplete()}}function h(b){p();var c=new google.ima.AdsRequest,e=a.getComputedStyle(d[0]);c.adTagUrl=b,c.linearAdSlotWidth=parseInt(e.width,10),c.linearAdSlotHeight=parseInt(e.height,10),c.nonLinearAdSlotWidth=parseInt(e.width,10),c.nonLinearAdSlotHeight=parseInt(e.height,10),v.requestAds(c)}function i(a){p(),w=a.getAdsManager(f.videoElement[0]),j(w)}function j(a){a.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,k,!1,this),a.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,l,!1,this),a.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m,!1,this),a.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,n,!1,this),a.addEventListener(google.ima.AdEvent.Type.COMPLETE,o,!1,this),a.init(r,s,google.ima.ViewMode.NORMAL),a.start()}function k(){p(),f.pause()}function l(){t||(f.play(),q())}function m(){w&&w.destroy(),q(),f.play()}function n(){q()}function o(){q()}function p(){d.css("display","block")}function q(){d.css("display","none")}var r,s,t=!1,u=new google.ima.AdDisplayContainer(d[0]),v=new google.ima.AdsLoader(u),w=null,x=!1;v.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,i,!1,this),v.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,m,!1,this),c.$watch(function(){return f.currentState},function(a,b){a!=b&&g(a)}),c.vgCompanion&&googletag.cmd.push(function(){googletag.defineSlot("/"+c.vgNetwork+"/"+c.vgUnitPath,c.vgCompanionSize,c.vgCompanion).addService(googletag.companionAds()).addService(googletag.pubads()),googletag.companionAds().setRefreshUnfilledSlots(!0),googletag.pubads().enableVideoAds(),googletag.enableServices()})}}}]);